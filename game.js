const canvas = document.getElementById("canvas");
const canvasContext = canvas.getContext("2d");
const pacFrames = document.getElementById("animations");
const hunterFrames = document.getElementById("hunters");

let createRect = (x, y, width, height, color) => {
  canvasContext.fillStyle = color;
  canvasContext.fillRect(x, y, width, height);
};
let fps = 30;
let blockSize = 20;
let score = 0;

const DR = 4;
const DU = 3;
const DL = 2;
const DB = 1;

let mapFirst = [
  [
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
  ],
  [
    "n",
    "n",
    "n",
    "n",
    "w",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    "w",
    "n",
    "n",
    "n",
    "n",
  ],
  [
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    " ",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
  ],
  [
    "n",
    "n",
    "n",
    "n",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "n",
    "n",
    "n",
    "n",
  ],
  [
    "n",
    "n",
    "n",
    "n",
    "w",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    "w",
    "n",
    "n",
    "n",
    "n",
  ],
  [
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    " ",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    " ",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
    "w",
    "w",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    "w",
    " ",
    " ",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    " ",
    " ",
    "w",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
    " ",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    " ",
    "w",
  ],
  [
    "w",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    " ",
    "w",
  ],
  [
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
    "w",
  ],
];

let gameRender = () => {
  update();
  draw();
};

let update = () => {
  pacman.moveProcess();
  pacman.eat();
};

let draw = () => {
  createRect(0, 0, canvas.width, canvas.height, "black");
  drawWalls();
  drawMass();
  pacman.draw();
  //todo
};

let drawMass = () => {
  for (let i = 0; i < mapFirst.length; i++) {
    for (let j = 0; j < mapFirst[0].length; j++) {
      if (mapFirst[i][j] == " ") {
        createRect(
          j * blockSize + blockSize / 3,
          i * blockSize + blockSize / 3,
          blockSize / 3,
          blockSize / 3,
          "yellow"
        );
      }
    }
  }
};

let gameInterval = setInterval(gameRender, 1000 / fps);

let drawWalls = () => {
  for (let i = 0; i < mapFirst.length; i++) {
    for (let j = 0; j < mapFirst[0].length; j++) {
      if (mapFirst[i][j] == "w") {
        createRect(
          j * blockSize,
          i * blockSize,
          blockSize,
          blockSize,
          "#878f99"
        );
      }
    }
  }
};

let createNewPacman = () => {
  pacman = new Pac(blockSize, blockSize, blockSize, blockSize, blockSize / 5);
};

createNewPacman();
gameRender();

window.addEventListener("keydown", (event) => {
  let k = event.keyCode;

  setTimeout(() => {
    if (k == 37 || k == 65) {
      //left
      pacman.nextDirection = DL;
    } else if (k == 38 || k == 87) {
      //up
      pacman.nextDirection = DU;
    } else if (k == 39 || k == 68) {
      //right
      pacman.nextDirection = DR;
    } else if (k == 40 || k == 83) {
      //down
      pacman.nextDirection = DB;
    }
  }, 1);
});
